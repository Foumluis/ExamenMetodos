{% extends 'base.html' %}

{% block title %}Cantidad de Ventas por Categoría{% endblock %}

{% block content %}


<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="bi bi-cart-check me-2"></i>Cantidad de Ventas por Categoría</h2>
            <p class="text-muted">Análisis del volumen de ventas en cada categoría de productos</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Distribución de Ventas</h5>
                </div>
                <div class="card-body">
                    <canvas id="ventasCategoriaChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Top Categorías</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Ropa
                            <span class="badge bg-primary rounded-pill">{{ y.0 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Accesorios
                            <span class="badge bg-primary rounded-pill">{{ y.1 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Calzado
                            <span class="badge bg-primary rounded-pill">{{ y.2 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Outerwear
                            <span class="badge bg-primary rounded-pill">{{ y.3 }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ y|json_script:"y" }}
{{ x|json_script:"x" }}

<script>

    const y = JSON.parse(document.getElementById('y').textContent);
    const x = JSON.parse(document.getElementById('x').textContent);
    let delayed;
    const ctx = document.getElementById('ventasCategoriaChart').getContext('2d');

    const miGrafico = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: x,
        datasets: [{
          label: 'Ventas ($)',
          data: y,
          backgroundColor: ["#7EEC7E", "#7fa7c4", "#f48787", "#fdce87"],
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        animation: {
          onComplete: () => {
            delayed = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayed) {
              delay = context.dataIndex * 300 + context.datasetIndex * 100;
            }
            return delay;
          },
        },
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Cantidad de ventas' }
          },
          x: {
            title: { display: true, text: 'Categorías' }
          }
        }
      }
    });
</script>
{% endblock %}
